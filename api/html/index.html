<!DOCTYPE html>
<html>
  <head>
    <script src="
https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js
"></script>
    <style>
      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      table {
        margin: 40px 0px;
        width: 100%;
        border-spacing: 0px;
        break-inside: avoid;
      }
      thead,
      tbody {
        height: 40px;
        font-weight: 500;
        background-color: #f3f3f3;
      }
      td {
        padding: 10px;
        border: 1px solid #6466a911;
      }
      thead {
        background-color: #6466a9;
        color: white;
        font-weight: 500;
      }

      .page-wrapper {
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .page-container {
        width: 600px;
        margin: 40px;
      }
      .canvas-container {
        margin: 40px 0px;
        width: 100%;
        break-inside: avoid;
      }
      .date-table {
        text-align: left;
        width: 100%;
        break-inside: avoid;
      }
      .line-separator {
        width: 100%;
        height: 1px;
        background-color: #c6c6c6;
        margin: 10px 0px;
      }
      .page-header-container {
        width: 100%;
        display: flex;
        justify-content: space-between;
        flex-direction: row;
      }
      .logo-container {
        width: 120px;
        display: flex;
        align-items: center;
      }
      .logo {
        width: 100%;
        height: auto;
      }
      @page {
        margin: 40px;
      }
    </style>
    <title></title>
  </head>
  <body>
    <div class="page-wrapper" id="wrapper">
      <div class="page-container" id="container">
        <div class="page-header-container">
          <h2>Report Summary</h2>
          <div class="logo-container">
            <img src="./4site-logo.svg" alt="logo" class="logo" />
          </div>
        </div>
        <div class="line-separator" />
        <script>
          {
            // // vercel function repalces {data} with report json
            // const data = "{data}";
            // load json data
            fetch("report.json")
              .then((response) => response.json())
              .then(({ tables, summary }) => {
                // const { tables, summary } = data;
                // date table
                const dateTable = document.createElement("table");
                const dateHeadCell = dateTable
                  .createTHead()
                  .insertRow()
                  .insertCell();
                const datebodyCell = dateTable
                  .createTBody()
                  .insertRow()
                  .insertCell();
                dateHeadCell.textContent = "Dates";
                datebodyCell.textContent = summary.dates;
                document.getElementById("container").appendChild(dateTable);

                // location table
                const locationTable = document.createElement("table");
                const locHeadRow = locationTable.createTHead().insertRow();
                const locBody = locationTable.createTBody();

                summary.overview.map((location, index) => {
                  const row = locBody.insertRow(index);
                  location.map((loc) => {
                    if (index === 0) {
                      locHeadRow.insertCell().textContent = loc;
                    } else {
                      const cell = row.insertCell();
                      cell.textContent = loc;
                    }
                  });
                });

                document.getElementById("container").appendChild(locationTable);

                // create new charts
                tables.map((table) => {
                  const divEl = document.createElement("div");
                  divEl.setAttribute("class", "canvas-container");

                  const canvasEl = document.createElement("canvas");
                  canvasEl.setAttribute("id", table.title);

                  divEl.appendChild(canvasEl);
                  document.getElementById("container").appendChild(divEl);

                  const myChart = new Chart(
                    document.getElementById(table.title),
                    {
                      type: "line",
                      data: {
                        labels: table.rows.map((row) => row[0]),
                        datasets: [
                          {
                            label: table.title,
                            data: table.rows.map((row) =>
                              Number(row[1].replace("%", ""))
                            ),
                          },
                        ],
                      },
                      options: {
                        borderColor: table.color,
                        backgroundColor: table.color,
                        tension: 0.2,
                        pointRadius: 0,
                        borderWidth: 2,
                        width: 1,
                        scales: {
                          x: {
                            ticks: {
                              maxRotation: 90,
                              minRotation: 0,
                              font: {
                                size: 9,
                              },
                            },
                          },
                          y: {
                            min: 0,
                            max: 100,
                            ticks: {
                              stepSize: 20,
                              callback: (value) => value + "%",
                            },
                            scaleLabel: {
                              display: true,
                              labelString: "Percentage",
                            },
                          },
                        },
                      },
                    }
                  );
                });
              })
              .catch((error) => console.error(error));
          }
        </script>
      </div>
    </div>
  </body>
</html>
